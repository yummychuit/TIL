# Movie Data

Python을 통하여 웹 크롤러 및 API 활동을 통해 데이터를 수집하고 원하는 형태로 가공합니다.
추후 영화 평점 사이트에 필요한 데이터를 프로그래밍을 통해 수집합니다.

## 준비사항
1. Python 환경설정
- Python 3.6 이상
2. 필수 라이브러리 활용
- requests
3. 필수 API 활용
- 영화진흥위원회 오픈 API
    - 주간/주말 박스오피스 API서비스
    - 영화 상세정보 API서비스
- 네이버 영화 검색 API

## API 정보


## 작동 방법
1. 영화진흥위원회 오픈 API(주간/주말 박스오피스 데이터)
- 최근 10주간 데이터 중에 주간 박스오피스 TOP10 데이터를 수집합니다. 해당 데이터는 향후 영화 평점 사이트에서 기본으로 제공되는 영화 목록으로 사용될 예정입니다.
    - 주간(월~일)까지 기간의 데이터를 총 10주간 조회합니다.
    - 기준일(마지막 일자)은 2019년 1월 13일입니다.
    - 다양성/상업 영화, 한국/외국 영화, 모든 상영지역을 포함합니다.
    - 중복된 정보는 최신 정보로 반영합니다.
    - 영화 대표코드, 영화명, 해당일 누적관객수, 해당일을 기록합니다.

우선 오픈 API를 사용하기 위해서는 각 사이트의 절차를 거쳐 인증을 받아야 합니다. 인증을 받았다면 필요한 정보를 수집하기 위해 영화진흥위원회 오픈 API에서 필수 라이브러리인 requests와 json 라이브러리를 통하여 dictionary의 형태로 정보를 받아옵니다. 정해진 날로부터 지난 10주간의 정보가 필요하기 때문에 datetime 과 timedelta를 활용하여 날짜 list를 만들고 url에 입력되도록 하여 10주간의 데이터를 받아옵니다. 사이트별 이용가이드를 보며 원하는 정보의 key값을 넣어 수집하고자 하는 데이터를 리스트로 모아 dictionary의 value값으로 만들어 줍니다. dictionary는 key값이 중복이 허용되지 않아 가장 마지막 데이터가 남기때문에 중복된 정보를 삭제할 수 있습니다. 마지막으로 이 dictionary의 value 값들을 boxoffice.csv 파일에 저장해줍니다.

영화 대표코드, 영화명, 해당일 누적관객수, 해당일 순서로 나열되어 있는 것을 확인할 수 있습니다.

2. 영화진흥위원회 오픈 API(영화 상세정보)
- 위에서 수집한 영화 대표코드를 활용하여 상세정보를 수집합니다. 해당 데이터는 향후 영화 평점 사이트에서 영화 정보로 활용 될 예정입니다.
    - 영화별로 영화 대표코드, 영화명(국문), 영화명(영문), 영화명(원문), 개봉연도, 상영시간, 장르, 감독명, 관람등급, 배우1, 배우2, 배우3 의 정보를 기록합니다. (배우는 최대 3명)

위에서 수집한 정보를 활용하여 영화 대표코드의 list를 새로 만들었습니다. 위에서 했던 방식과 같이 오픈 API에서 dictionary 형태의 정보를 받아와 원하는 정보의 key값을 넣어 필요한 데이터를 받아옵니다. 데이터 중 내용이 없는 경우가 있어 오류가 발생하거나 데이터가 누락될 수 있습니다. 이를 해결하기 위해 try, except와 if문을 사용하여 지나치거나 빈 list로 값이 나오게 하였습니다. 위에서와 같은 방법으로 수집한 데이터를 dictionary의 value값으로 모아 movie.csv 파일에 저장하였습니다.

영화 대표코드, 영화명(국문), 영화명(영문), 영화명(원문), 개봉연도, 상영시간, 장르, 감독명, 관람등급, 배우1, 배우2, 배우3 순으로 데이터가 수집된 것을 확인할 수 있습니다.

3. 네이버 영화 검색 API
- 앞서 영진위에서 얻은 영화명(국문)을 바탕으로 네이버 영화 검색 API를 통해 추가적인 데이터를 수집합니다. 해당 데이터는 향후 영화 평점 사이트에서 기준 평점 및 영화 포스터 썸네일로 활용될 것입니다.
    - 영화명을 통해 요청하여 영화별로 영진위 영화 대표코드, 영화 썸네일 이미지의 URL, 하이퍼 텍스트 link, 유저 평점을 저장합니다.

위에서 영화 진흥 위원회의 오픈 API를 이용하여 수집한 정보 중 영화 코드와 영화명을 이용합니다. 네이버 영화 검색 API에서 requests와 json 라이브러리를 활용하여 필요한 정보의 데이터를 받아옵니다. 받아온 정보에 html 언어를 표현하는 꺾쇠괄호를 포함할 수 있기 때문에 파이썬이 사용할 수 있는 객체로 컴파일 해주는 기능을 하는 re 라이브러리를 이용하여 키워드가 되는 단어만 남겼습니다.  나머지는 전과 같은 방식으로 수집한 데이터를 dictionary의 value값으로 모아 movie_naver.csv 파일로 저장하였습니다. 네이버 API에서 문제없이 데이터를 받아오기 위해 for문 속에 sleep을 넣어주었습니다.

영진위 영화 대표코드, 영화 썸네일 이미지의 URL, 하이퍼텍스트 link, 유저 평점이 순서대로 수집되어 있는 것을 확인할 수 있습니다.


4. 영화 포스터 이미지 저장
- 앞서 네이버 영화 검색 API를 통해 얻은 이미지 URL에 요청을 보내 실제 이미지 파일로 저장합니다. 해당 데이터는 향후 영화 목록에서 포스터 이미지로 사용될 것입니다.
    - 이미지 URL을 통하여 이미지 파일을 영진위 영화 대표코드.jpg 로 저장합니다. (wb옵션으로 저장)

마지막으로 위에서 수집한 내용 중 영화 대표코드와 영화 썸네일 이미지 URL을 이용하여 이미지 썸네일을 받아 대표코드를 이름으로 하여 이미지 폴더에 저장합니다.



### 결과 파일

```
movie/ README.md
       movie_kobis_weekly_python.py
       movie_detail_python.py
       movie_naver_python.py
       boxoffice.csv
       movie.csv
       movie_naver.csv
images/ movie_code.jpg * 43
```

